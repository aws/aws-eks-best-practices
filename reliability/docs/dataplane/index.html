
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.aws.amazon.com/eks/latest/best-practices/data-plane.html">
      
      
        <link rel="prev" href="../controlplane/">
      
      
        <link rel="next" href="../../../networking/index/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Data Plane - EKS Best Practices Guides</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-VQGL8B2FH8"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-VQGL8B2FH8",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-VQGL8B2FH8",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  
    <meta http-equiv="refresh" content="0; URL='https://docs.aws.amazon.com/eks/latest/best-practices/data-plane.html'" />
    <link rel="canonical" href="https://docs.aws.amazon.com/eks/latest/best-practices/data-plane.html" />
  
  

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#eks-data-plane" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
<h2 style="color:#F2F2F2;text-align: center;"><b> The EKS Best Practices Guide has moved to the <a style="color:#ff9900;text-decoration: underline" href="https://docs.aws.amazon.com/eks/latest/best-practices/introduction.html">AWS Documentation</a></u>. Check there for the latest updates. </b></h2>

          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="EKS Best Practices Guides" class="md-header__button md-logo" aria-label="EKS Best Practices Guides" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EKS Best Practices Guides
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Data Plane
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../ko/reliability/docs/dataplane/" hreflang="ko" class="md-select__link">
              한국어
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/aws/aws-eks-best-practices" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-eks-best-practices
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="EKS Best Practices Guides" class="md-nav__button md-logo" aria-label="EKS Best Practices Guides" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    EKS Best Practices Guides
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aws/aws-eks-best-practices" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    aws/aws-eks-best-practices
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Security
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/iam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Identity and Access Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/pods/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pod Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/multitenancy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi-tenancy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/detective/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Detective Controls
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Encryption and Secrets Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/runtime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runtime Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/hosts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Infrastructure Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/compliance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Regulatory Compliance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/incidents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Incident Response and Forensics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../security/docs/multiaccount/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi Account Strategy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cluster Autoscaling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Cluster Autoscaling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../karpenter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Karpenter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cluster-autoscaling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cluster-Autoscaler
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reliability
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reliability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Applications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../controlplane/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Control Plane
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Data Plane
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Data Plane
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      Recommendations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-ec2-auto-scaling-groups-to-create-worker-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Use EC2 Auto Scaling Groups to create worker nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-kubernetes-cluster-autoscaler-to-scale-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Use Kubernetes Cluster Autoscaler to scale nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-over-provisioning-with-cluster-autoscaler" class="md-nav__link">
    <span class="md-ellipsis">
      Configure over-provisioning with Cluster Autoscaler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-cluster-autoscaler-with-multiple-auto-scaling-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Using Cluster Autoscaler with multiple Auto Scaling Groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-cluster-autoscaler-with-local-storage" class="md-nav__link">
    <span class="md-ellipsis">
      Using Cluster Autoscaler with local storage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spread-worker-nodes-and-workload-across-multiple-azs" class="md-nav__link">
    <span class="md-ellipsis">
      Spread worker nodes and workload across multiple AZs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensure-capacity-in-each-az-when-using-ebs-volumes" class="md-nav__link">
    <span class="md-ellipsis">
      Ensure capacity in each AZ when using EBS volumes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-node-problem-detector" class="md-nav__link">
    <span class="md-ellipsis">
      Run node-problem-detector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reserving-resources-for-system-and-kubernetes-daemons" class="md-nav__link">
    <span class="md-ellipsis">
      Reserving resources for system and Kubernetes daemons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-qos" class="md-nav__link">
    <span class="md-ellipsis">
      Implement QoS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-and-size-resource-requestslimits-for-all-workloads" class="md-nav__link">
    <span class="md-ellipsis">
      Configure and Size Resource Requests/Limits for all Workloads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-resource-quotas-for-namespaces" class="md-nav__link">
    <span class="md-ellipsis">
      Configure resource quotas for namespaces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limit-container-resource-usage-within-a-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      Limit container resource usage within a namespace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coredns" class="md-nav__link">
    <span class="md-ellipsis">
      CoreDNS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommendations_1" class="md-nav__link">
    <span class="md-ellipsis">
      Recommendations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#monitor-coredns-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor CoreDNS metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-nodelocal-dnscache" class="md-nav__link">
    <span class="md-ellipsis">
      Use NodeLocal DNSCache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-cluster-proportional-scaler-for-coredns" class="md-nav__link">
    <span class="md-ellipsis">
      Configure cluster-proportional-scaler for CoreDNS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choosing-an-ami-with-node-group" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing an AMI with Node Group
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Networking
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Networking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/subnets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VPC and Subnet Considerations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/vpc-cni/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Amazon VPC CNI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/ip-optimization-strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimizing IP Address Utilization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/ipv6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running IPv6 Clusters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/custom-networking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Networking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/prefix-mode/index_linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prefix Mode for Linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/prefix-mode/index_windows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prefix Mode for Windows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/sgpp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security Groups per Pod
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/loadbalancing/loadbalancing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Load Balancing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring for Network performance issues
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/ipvs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running kube-proxy in IPVS Mode
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Scalability
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Scalability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/control-plane/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Control Plane
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/data-plane/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Plane
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/cluster-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cluster Services
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/workloads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workloads
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/scaling_theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The theory behind scaling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/kcp_monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Control plane monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/node_efficiency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node efficiency and scaling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/kubernetes_slos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes SLOs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../scalability/docs/quotas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Known limits and service quotas
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../upgrades/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cluster Upgrades
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cost Optimization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Cost Optimization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cost_optimization_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cfm_framework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cloud Financial Management Framework
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/awareness/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Awareness
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cost_opt_compute/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compute
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cost_opt_networking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cost_opt_storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cost_optimization/cost_opt_observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Observability
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Windows Containers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Windows Containers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/ami/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AMI Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/gmsa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gMSA for Windows Containers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/hardening/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows Server Hardening
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/images/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scanning Windows Images
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/licensing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows Versions and Licensing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring Windows Containers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/networking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows Networking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/oom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Memory and Systems Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/patching/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Infrastructure Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/scheduling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Scheduling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pod Security for Windows Containers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../windows/docs/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage Options
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recommendations" class="md-nav__link">
    <span class="md-ellipsis">
      Recommendations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-ec2-auto-scaling-groups-to-create-worker-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Use EC2 Auto Scaling Groups to create worker nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-kubernetes-cluster-autoscaler-to-scale-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Use Kubernetes Cluster Autoscaler to scale nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-over-provisioning-with-cluster-autoscaler" class="md-nav__link">
    <span class="md-ellipsis">
      Configure over-provisioning with Cluster Autoscaler
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-cluster-autoscaler-with-multiple-auto-scaling-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Using Cluster Autoscaler with multiple Auto Scaling Groups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-cluster-autoscaler-with-local-storage" class="md-nav__link">
    <span class="md-ellipsis">
      Using Cluster Autoscaler with local storage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spread-worker-nodes-and-workload-across-multiple-azs" class="md-nav__link">
    <span class="md-ellipsis">
      Spread worker nodes and workload across multiple AZs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensure-capacity-in-each-az-when-using-ebs-volumes" class="md-nav__link">
    <span class="md-ellipsis">
      Ensure capacity in each AZ when using EBS volumes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-node-problem-detector" class="md-nav__link">
    <span class="md-ellipsis">
      Run node-problem-detector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reserving-resources-for-system-and-kubernetes-daemons" class="md-nav__link">
    <span class="md-ellipsis">
      Reserving resources for system and Kubernetes daemons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implement-qos" class="md-nav__link">
    <span class="md-ellipsis">
      Implement QoS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-and-size-resource-requestslimits-for-all-workloads" class="md-nav__link">
    <span class="md-ellipsis">
      Configure and Size Resource Requests/Limits for all Workloads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-resource-quotas-for-namespaces" class="md-nav__link">
    <span class="md-ellipsis">
      Configure resource quotas for namespaces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limit-container-resource-usage-within-a-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      Limit container resource usage within a namespace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coredns" class="md-nav__link">
    <span class="md-ellipsis">
      CoreDNS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommendations_1" class="md-nav__link">
    <span class="md-ellipsis">
      Recommendations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Recommendations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#monitor-coredns-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor CoreDNS metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-nodelocal-dnscache" class="md-nav__link">
    <span class="md-ellipsis">
      Use NodeLocal DNSCache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-cluster-proportional-scaler-for-coredns" class="md-nav__link">
    <span class="md-ellipsis">
      Configure cluster-proportional-scaler for CoreDNS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choosing-an-ami-with-node-group" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing an AMI with Node Group
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<div class="admonition info">
<p class="admonition-title">We've Moved to the AWS Docs! 🚀</p>
<p>This content has been updated and relocated to improve your experience. 
Please visit our new site for the latest version:
<a href="https://docs.aws.amazon.com/eks/latest/best-practices/data-plane.html">AWS EKS Best Practices Guide</a> on the AWS Docs</p>
<p>Bookmarks and links will continue to work, but we recommend updating them for faster access in the future.</p>
</div>
<hr />
<h1 id="eks-data-plane">EKS Data Plane<a class="headerlink" href="#eks-data-plane" title="Permanent link">&para;</a></h1>
<p>To operate high-available and resilient applications, you need a highly-available and resilient data plane. An elastic data plane ensures that Kubernetes can scale and heal your applications automatically. A resilient data plane consists of two or more worker nodes, can grow and shrink with the workload, and automatically recover from failures.</p>
<p>You have two choices for worker nodes with EKS: <a href="https://docs.aws.amazon.com/eks/latest/userguide/worker.html">EC2 instances</a> and <a href="https://docs.aws.amazon.com/eks/latest/userguide/fargate.html">Fargate</a>. If you choose EC2 instances, you can manage the worker nodes yourself or use <a href="https://docs.aws.amazon.com/eks/latest/userguide/managed-node-groups.html">EKS managed node groups</a>. You can have a cluster with a mix of managed, self-managed worker nodes, and Fargate. </p>
<p>EKS on Fargate offers the easiest path to a resilient data plane. Fargate runs each Pod in an isolated compute environment. Each Pod running on Fargate gets its own worker node. Fargate automatically scales the data plane as Kubernetes scales pods. You can scale both the data plane and your workload by using the <a href="https://docs.aws.amazon.com/eks/latest/userguide/horizontal-pod-autoscaler.html">horizontal pod autoscaler</a>.</p>
<p>The preferred way to scale EC2 worker nodes is by using <a href="https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/cloudprovider/aws/README.md">Kubernetes Cluster Autoscaler</a>, <a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/AutoScalingGroup.html">EC2 Auto Scaling groups</a> or community projects like <a href="https://github.com/atlassian/escalator">Atlassian's Escalator</a>.</p>
<h2 id="recommendations">Recommendations<a class="headerlink" href="#recommendations" title="Permanent link">&para;</a></h2>
<h3 id="use-ec2-auto-scaling-groups-to-create-worker-nodes">Use EC2 Auto Scaling Groups to create worker nodes<a class="headerlink" href="#use-ec2-auto-scaling-groups-to-create-worker-nodes" title="Permanent link">&para;</a></h3>
<p>It is a best practice to create worker nodes using EC2 Auto Scaling groups instead of creating individual EC2 instances and joining them to the cluster. Auto Scaling Groups will automatically replace any terminated or failed nodes ensuring that the cluster always has the capacity to run your workload. </p>
<h3 id="use-kubernetes-cluster-autoscaler-to-scale-nodes">Use Kubernetes Cluster Autoscaler to scale nodes<a class="headerlink" href="#use-kubernetes-cluster-autoscaler-to-scale-nodes" title="Permanent link">&para;</a></h3>
<p>Cluster Autoscaler adjusts the size of the data plane when there are pods that cannot be run because the cluster has insufficient resources, and adding another worker node would help. Although Cluster Autoscaler is a reactive process, it waits until pods are in <em>Pending</em> state due to insufficient capacity in the cluster. When such an event occurs, it adds EC2 instances to the cluster. Whenever the cluster runs out of capacity, new replicas - or new pods - will be unavailable (<em>in Pending state</em>) until worker nodes are added. This delay may impact your applications' reliability if the data plane cannot scale fast enough to meet the demands of the workload. If a worker node is consistently underutilized and all of its pods can be scheduled on other worker nodes, Cluster Autoscaler terminates it.</p>
<h3 id="configure-over-provisioning-with-cluster-autoscaler">Configure over-provisioning with Cluster Autoscaler<a class="headerlink" href="#configure-over-provisioning-with-cluster-autoscaler" title="Permanent link">&para;</a></h3>
<p>Cluster Autoscaler triggers a scale-up of the data-plane when Pods in the cluster are already <em>Pending</em>. Hence, there may be a delay between the time your application needs more replicas, and when it, in fact, gets more replicas. An option to account for this possible delay is through adding more than required replicas, inflating the number of replicas for the application. </p>
<p>Another pattern that Cluster Autoscaler recommends uses <a href="https://github.com/kubernetes/autoscaler/blob/master/cluster-autoscaler/FAQ.md#how-can-i-configure-overprovisioning-with-cluster-autoscaler"><em>pause</em> Pods and the Priority Preemption feature</a>. The <em>pause Pod</em> runs a <a href="https://github.com/kubernetes/kubernetes/tree/master/build/pause">pause container</a>, which as the name suggests, does nothing but acts as a placeholder for compute capacity that can be used by other Pods in your cluster. Because it runs with a <em>very low assigned priority</em>, the pause Pod gets evicted from the node when another Pod needs to be created, and the cluster doesn't have available capacity. The Kubernetes Scheduler notices the eviction of the pause Pod and tries to reschedule it. But since the cluster is running at capacity, the pause Pod remains <em>Pending</em>, to which the Cluster Autoscaler reacts by adding nodes. </p>
<h3 id="using-cluster-autoscaler-with-multiple-auto-scaling-groups">Using Cluster Autoscaler with multiple Auto Scaling Groups<a class="headerlink" href="#using-cluster-autoscaler-with-multiple-auto-scaling-groups" title="Permanent link">&para;</a></h3>
<p>Run the Cluster Autoscaler with the <code>--node-group-auto-discovery</code> flag enabled. Doing so will allow the Cluster Autoscaler to find all autoscaling groups that include a particular defined tag and prevents the need to define and maintain each autoscaling group in the manifest.</p>
<h3 id="using-cluster-autoscaler-with-local-storage">Using Cluster Autoscaler with local storage<a class="headerlink" href="#using-cluster-autoscaler-with-local-storage" title="Permanent link">&para;</a></h3>
<p>By default, the Cluster Autoscaler does not scale-down nodes that have pods deployed with local storage attached. Set the <code>--skip-nodes-with-local-storage</code> flag to false to allow Cluster Autoscaler to scale-down these nodes.</p>
<h3 id="spread-worker-nodes-and-workload-across-multiple-azs">Spread worker nodes and workload across multiple AZs<a class="headerlink" href="#spread-worker-nodes-and-workload-across-multiple-azs" title="Permanent link">&para;</a></h3>
<p>You can protect your workloads from failures in an individual AZ by running worker nodes and pods in multiple AZs. You can control the AZ the worker nodes are created in using the subnets you create the nodes in.</p>
<p>If you are using Kubernetes 1.18+, the recommended method for spreading pods across AZs is to use <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/#spread-constraints-for-pods">Topology Spread Constraints for Pods</a>.</p>
<p>The deployment below spreads pods across AZs if possible, letting those pods run anyway if not:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>apiVersion: apps/v1
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>kind: Deployment
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>metadata:
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>  name: web-server
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>spec:
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>  replicas: 3
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>  selector:
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    matchLabels:
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>      app: web-server
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>  template:
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    metadata:
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>      labels:
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>        app: web-server
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    spec:
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>      topologySpreadConstraints:
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>        - maxSkew: 1
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>          whenUnsatisfiable: ScheduleAnyway
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>          topologyKey: topology.kubernetes.io/zone
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>          labelSelector:
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>            matchLabels:
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>              app: web-server
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>      containers:
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>      - name: web-app
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>        image: nginx
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>        resources:
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>          requests:
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>            cpu: 1
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>kube-scheduler</code> is only aware of topology domains via nodes that exist with those labels.  If the above deployment is deployed to a cluster with nodes only in a single zone, all of the pods will schedule on those nodes as <code>kube-scheduler</code> isn't aware of the other zones.  For this topology spread to work as expected with the scheduler, nodes must already exist in all zones.  This issue will be resolved in Kubernetes 1.24 with the addition of the <code>MinDomainsInPodToplogySpread</code> <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/#api">feature gate</a> which allows specifying a <code>minDomains</code> property to inform the scheduler of the number of eligible domains.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Setting <code>whenUnsatisfiable</code> to <code>DoNotSchedule</code> will cause pods to be unschedulable if the topology spread constraint can't be fulfilled.  It should only be set if its preferable for pods to not run instead of violating the topology spread constraint.</p>
</div>
<p>On older versions of Kubernetes, you can use pod anti-affinity rules to schedule pods across multiple AZs. The manifest below informs Kubernetes scheduler to <em>prefer</em> scheduling pods in distinct AZs. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>apiVersion: apps/v1
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>kind: Deployment
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>metadata:
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>  name: web-server
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>  labels:
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    app: web-server
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>spec:
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>  replicas: 4
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>  selector:
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    matchLabels:
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>      app: web-server
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>  template:
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    metadata:
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>      labels:
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>        app: web-server
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    spec:
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>      affinity:
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>        podAntiAffinity:
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>          preferredDuringSchedulingIgnoredDuringExecution:
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>          - podAffinityTerm:
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>              labelSelector:
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>                matchExpressions:
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>                - key: app
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>                  operator: In
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>                  values:
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>                  - web-server
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>              topologyKey: failure-domain.beta.kubernetes.io/zone
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>            weight: 100
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>      containers:
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>      - name: web-app
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>        image: nginx
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not require that pods be scheduled across distinct AZs otherwise, the number of pods in a deployment will never exceed the number of AZs. </p>
</div>
<h3 id="ensure-capacity-in-each-az-when-using-ebs-volumes">Ensure capacity in each AZ when using EBS volumes<a class="headerlink" href="#ensure-capacity-in-each-az-when-using-ebs-volumes" title="Permanent link">&para;</a></h3>
<p>If you use <a href="https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html">Amazon EBS to provide Persistent Volumes</a>, then you need to ensure that the pods and associated EBS volume are located in the same AZ. At the time of writing, EBS volumes are only available within a single AZ. A Pod cannot access EBS-backed persistent volumes located in a different AZ. Kubernetes <a href="https://kubernetes.io/docs/reference/kubernetes-api/labels-annotations-taints/#topologykubernetesiozone">scheduler knows which AZ a worker node</a> is located in. Kubernetes will always schedule a Pod that requires an EBS volume in the same AZ as the volume. However, if there are no worker nodes available in the AZ where the volume is located, then the Pod cannot be scheduled. </p>
<p>Create Auto Scaling Group for each AZ with enough capacity to ensure that the cluster always has capacity to schedule pods in the same AZ as the EBS volumes they need. In addition, you should enable the <code>--balance-similar-node-groups</code> feature in Cluster Autoscaler.</p>
<p>If you are running an application that uses EBS volume but has no requirements to be highly available, then you can restrict the deployment of the application to a single AZ. In EKS, worker nodes are automatically added <code>failure-domain.beta.kubernetes.io/zone</code> label, which contains the name of the AZ. You can see the labels attached to your nodes by running <code>kubectl get nodes --show-labels</code>. More information about built-in node labels is available <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#built-in-node-labels">here</a>. You can use node selectors to schedule a pod in a particular AZ. </p>
<p>In the example below, the pod will only be scheduled in <code>us-west-2c</code> AZ:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>apiVersion: v1
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>kind: Pod
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>metadata:
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>  name: single-az-pod
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>spec:
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>  affinity:
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    nodeAffinity:
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>      requiredDuringSchedulingIgnoredDuringExecution:
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>        nodeSelectorTerms:
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        - matchExpressions:
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>          - key: failure-domain.beta.kubernetes.io/zone
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>            operator: In
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>            values:
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>            - us-west-2c
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>  containers:
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>  - name: single-az-container
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>    image: kubernetes/pause
</code></pre></div>
<p>Persistent volumes (backed by EBS) are also automatically labeled with the name of AZ; you can see which AZ your persistent volume belongs to by running <code>kubectl get pv -L topology.ebs.csi.aws.com/zone</code>. When a pod is created and claims a volume, Kubernetes will schedule the Pod on a node in the same AZ as the volume. </p>
<p>Consider this scenario; you have an EKS cluster with one node group. This node group has three worker nodes spread across three AZs. You have an application that uses an EBS-backed Persistent Volume. When you create this application and the corresponding volume, its Pod gets created in the first of the three AZs. Then, the worker node that runs this Pod becomes unhealthy and subsequently unavailable for use. Cluster Autoscaler will replace the unhealthy node with a new worker node; however, because the autoscaling group spans across three AZs, the new worker node may get launched in the second or the third AZ, but not in the first AZ as the situation demands. As the AZ-constrained EBS volume only exists in the first AZ, but there are no worker nodes available in that AZ, the Pod cannot be scheduled. Therefore, you should create one node group in each AZ, so there is always enough capacity available to run pods that cannot be scheduled in other AZs. </p>
<p>Alternatively, <a href="https://github.com/kubernetes-sigs/aws-efs-csi-driver">EFS</a> can simplify cluster autoscaling when running applications that need persistent storage. Clients can access EFS file systems concurrently from all the AZs in the region. Even if a Pod using EFS-backed Persistent Volume gets terminated and gets scheduled in different AZ, it will be able to mount the volume.</p>
<h3 id="run-node-problem-detector">Run node-problem-detector<a class="headerlink" href="#run-node-problem-detector" title="Permanent link">&para;</a></h3>
<p>Failures in worker nodes can impact the availability of your applications. <a href="https://github.com/kubernetes/node-problem-detector">node-problem-detector</a> is a Kubernetes add-on that you can install in your cluster to detect worker node issues. You can use a <a href="https://github.com/kubernetes/node-problem-detector#remedy-systems">npd's remedy system</a> to drain and terminate the node automatically.</p>
<h3 id="reserving-resources-for-system-and-kubernetes-daemons">Reserving resources for system and Kubernetes daemons<a class="headerlink" href="#reserving-resources-for-system-and-kubernetes-daemons" title="Permanent link">&para;</a></h3>
<p>You can improve worker nodes' stability by <a href="https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/">reserving compute capacity for the operating system and Kubernetes daemons</a>. Pods  - especially ones without <code>limits</code> declared - can saturate system resources putting nodes in a situation where operating system processes and Kubernetes daemons (<code>kubelet</code>, container runtime, etc.) compete with pods for system resources. You can use <code>kubelet</code> flags <code>--system-reserved</code> and <code>--kube-reserved</code> to reserve resources for system process (<code>udev</code>, <code>sshd</code>, etc.) and Kubernetes daemons respectively. </p>
<p>If you use the <a href="https://docs.aws.amazon.com/eks/latest/userguide/eks-optimized-ami.html">EKS-optimized Linux AMI</a>, the CPU, memory, and storage are reserved for the system and Kubernetes daemons by default. When worker nodes based on this AMI launch, EC2 user-data is configured to trigger the <a href="https://github.com/awslabs/amazon-eks-ami/blob/master/files/bootstrap.sh"><code>bootstrap.sh</code> script</a>. This script calculates CPU and memory reservations based on the number of CPU cores and total memory available on the EC2 instance. The calculated values are written to the <code>KubeletConfiguration</code> file located at <code>/etc/kubernetes/kubelet/kubelet-config.json</code>. </p>
<p>You may need to increase the system resource reservation if you run custom daemons on the node and the amount of CPU and memory reserved by default is insufficient. </p>
<p><code>eksctl</code> offers the easiest way to customize <a href="https://eksctl.io/usage/customizing-the-kubelet/">resource reservation for system and Kubernetes daemons</a>. </p>
<h3 id="implement-qos">Implement QoS<a class="headerlink" href="#implement-qos" title="Permanent link">&para;</a></h3>
<p>For critical applications, consider defining <code>requests</code>=<code>limits</code> for the container in the Pod. This will ensure that the container will not be killed if another Pod requests resources.</p>
<p>It is a best practice to implement CPU and memory limits for all containers as it prevents a container inadvertently consuming system resources impacting the availability of other co-located processes.</p>
<h3 id="configure-and-size-resource-requestslimits-for-all-workloads">Configure and Size Resource Requests/Limits for all Workloads<a class="headerlink" href="#configure-and-size-resource-requestslimits-for-all-workloads" title="Permanent link">&para;</a></h3>
<p>Some general guidance can be applied to sizing resource requests and limits for workloads:</p>
<ul>
<li>
<p>Do not specify resource limits on CPU.  In the absence of limits, the request acts as a weight on <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#how-pods-with-resource-limits-are-run">how much relative CPU time containers get</a>. This allows your workloads to use the full CPU without an artificial limit or starvation.</p>
</li>
<li>
<p>For non-CPU resources, configuring <code>requests</code>=<code>limits</code> provides the most predictable behavior. If <code>requests</code>!=<code>limits</code>, the container also has its <a href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/#qos-classes">QOS</a> reduced from Guaranteed to Burstable making it more likely to be evicted in the event of <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/node-pressure-eviction/">node pressure</a>.</p>
</li>
<li>
<p>For non-CPU resources, do not specify a limit that is much larger than the request.  The larger <code>limits</code> are configured relative to <code>requests</code>, the more likely nodes will be overcommitted leading to high chances of workload interruption.</p>
</li>
<li>
<p>Correctly sized requests are particularly important when using a node auto-scaling solution like <a href="https://aws.github.io/aws-eks-best-practices/karpenter/">Karpenter</a> or <a href="https://aws.github.io/aws-eks-best-practices/cluster-autoscaling/">Cluster AutoScaler</a>.  These tools look at your workload requests to determine the number and size of nodes to be provisioned. If your requests are too small with larger limits, you may find your workloads evicted or OOM killed if they have been tightly packed on a node.</p>
</li>
</ul>
<p>Determining resource requests can be difficult, but tools like the <a href="https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler">Vertical Pod Autoscaler</a> can help you 'right-size' the requests by observing container resource usage at runtime.  Other tools that may be useful for determining request sizes include:</p>
<ul>
<li><a href="https://github.com/FairwindsOps/goldilocks">Goldilocks</a></li>
<li><a href="https://www.parca.dev/">Parca</a></li>
<li><a href="https://prodfiler.com/">Prodfiler</a></li>
<li><a href="https://mhausenblas.info/right-size-guide/">rsg</a></li>
</ul>
<h3 id="configure-resource-quotas-for-namespaces">Configure resource quotas for namespaces<a class="headerlink" href="#configure-resource-quotas-for-namespaces" title="Permanent link">&para;</a></h3>
<p>Namespaces are intended for use in environments with many users spread across multiple teams, or projects. They provide a scope for names and are a way to divide cluster resources between multiple teams, projects, workloads. You can limit the aggregate resource consumption in a namespace. The <a href="https://kubernetes.io/docs/concepts/policy/resource-quotas/"><code>ResourceQuota</code></a> object can limit the quantity of objects that can be created in a namespace by type, as well as the total amount of compute resources that may be consumed by resources in that project. You can limit the total sum of storage and/or compute (CPU and memory) resources that can be requested in a given namespace.</p>
<blockquote>
<p>If resource quota is enabled for a namespace for compute resources like CPU and memory, users must specify requests or limits for each container in that namespace.</p>
</blockquote>
<p>Consider configuring quotas for each namespace. Consider using <code>LimitRanges</code> to automatically apply preconfigured limits to containers within a namespaces. </p>
<h3 id="limit-container-resource-usage-within-a-namespace">Limit container resource usage within a namespace<a class="headerlink" href="#limit-container-resource-usage-within-a-namespace" title="Permanent link">&para;</a></h3>
<p>Resource Quotas help limit the amount of resources a namespace can use. The <a href="https://kubernetes.io/docs/concepts/policy/limit-range/"><code>LimitRange</code> object</a> can help you implement minimum and maximum resources a container can request. Using <code>LimitRange</code> you can set a default request and limits for containers, which is helpful if setting compute resource limits is not a standard practice in your organization. As the name suggests, <code>LimitRange</code> can enforce minimum and maximum compute resources usage per Pod or Container in a namespace. As well as, enforce minimum and maximum storage request per PersistentVolumeClaim in a namespace.</p>
<p>Consider using <code>LimitRange</code> in conjunction with <code>ResourceQuota</code> to enforce limits at a container as well as namespace level. Setting these limits will ensure that a container or a namespace does not impinge on resources used by other tenants in the cluster. </p>
<h2 id="coredns">CoreDNS<a class="headerlink" href="#coredns" title="Permanent link">&para;</a></h2>
<p>CoreDNS fulfills name resolution and service discovery functions in Kubernetes. It is installed by default on EKS clusters. For interoperability, the Kubernetes Service for CoreDNS is still named <a href="https://kubernetes.io/docs/tasks/administer-cluster/dns-custom-nameservers/">kube-dns</a>. CoreDNS Pods run as part of a Deployment in <code>kube-system</code> namespace, and in EKS, by default, it runs two replicas with declared requests and limits. DNS queries are sent to the <code>kube-dns</code> Service that runs in the <code>kube-system</code> Namespace.</p>
<h2 id="recommendations_1">Recommendations<a class="headerlink" href="#recommendations_1" title="Permanent link">&para;</a></h2>
<h3 id="monitor-coredns-metrics">Monitor CoreDNS metrics<a class="headerlink" href="#monitor-coredns-metrics" title="Permanent link">&para;</a></h3>
<p>CoreDNS has built in support for <a href="https://github.com/coredns/coredns/tree/master/plugin/metrics">Prometheus</a>. You should especially consider monitoring CoreDNS latency (<code>coredns_dns_request_duration_seconds_sum</code>, before <a href="https://github.com/coredns/coredns/blob/master/notes/coredns-1.7.0.md">1.7.0</a> version the metric was called <code>core_dns_response_rcode_count_total</code>), errors (<code>coredns_dns_responses_total</code>, NXDOMAIN, SERVFAIL, FormErr) and CoreDNS Pod's memory consumption.</p>
<p>For troubleshooting purposes, you can use kubectl to view CoreDNS logs:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">for</span><span class="w"> </span>p<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>-l<span class="w"> </span>k8s-app<span class="o">=</span>kube-dns<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[*].metadata.name}&#39;</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>kubectl<span class="w"> </span>logs<span class="w"> </span><span class="nv">$p</span><span class="w"> </span>-n<span class="w"> </span>kube-system<span class="p">;</span><span class="w"> </span><span class="k">done</span>
</code></pre></div>
<h3 id="use-nodelocal-dnscache">Use NodeLocal DNSCache<a class="headerlink" href="#use-nodelocal-dnscache" title="Permanent link">&para;</a></h3>
<p>You can improve the Cluster DNS performance by running <a href="https://kubernetes.io/docs/tasks/administer-cluster/nodelocaldns/">NodeLocal DNSCache</a>. This feature runs a DNS caching agent on cluster nodes as a DaemonSet. All the pods use the DNS caching agent running on the node for name resolution instead of using <code>kube-dns</code> Service.</p>
<h3 id="configure-cluster-proportional-scaler-for-coredns">Configure cluster-proportional-scaler for CoreDNS<a class="headerlink" href="#configure-cluster-proportional-scaler-for-coredns" title="Permanent link">&para;</a></h3>
<p>Another method of improving Cluster DNS performance is by <a href="https://kubernetes.io/docs/tasks/administer-cluster/dns-horizontal-autoscaling/#enablng-dns-horizontal-autoscaling">automatically horizontally scaling the CoreDNS Deployment</a> based on the number of nodes and CPU cores in the cluster. <a href="https://github.com/kubernetes-sigs/cluster-proportional-autoscaler/blob/master/README.md">Horizontal cluster-proportional-autoscaler</a> is a container that resizes the number of replicas of a Deployment based on the size of the schedulable data-plane.</p>
<p>Nodes and the aggregate of CPU cores in the nodes are the two metrics with which you can scale CoreDNS. You can use both metrics simultaneously. If you use larger nodes, CoreDNS scaling is based on the number of CPU cores. Whereas, if you use smaller nodes, the number of CoreDNS replicas depends on the  CPU cores in your data-plane. Proportional autoscaler configuration looks like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>linear: &#39;{&quot;coresPerReplica&quot;:256,&quot;min&quot;:1,&quot;nodesPerReplica&quot;:16}&#39;
</code></pre></div>
<h3 id="choosing-an-ami-with-node-group">Choosing an AMI with Node Group<a class="headerlink" href="#choosing-an-ami-with-node-group" title="Permanent link">&para;</a></h3>
<p>EKS provides optimized EC2 AMIs that are used by customers to create both self-managed and managed nodegroups. These AMIs are published in every region for every supported Kubernetes version. EKS marks these AMIs as deprecated when any CVEs or bugs are discovered. Hence, the recommendation is not to consume deprecated AMIs while choosing an AMI for the node group.</p>
<p>Deprecated AMIs can be filtered using Ec2 describe-images api using below command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>aws ec2 describe-images --image-id ami-0d551c4f633e7679c --no-include-deprecated
</code></pre></div>
<p>You can also recognize a deprecated AMI by verifying if the describe-image output contains a DeprecationTime as a field. For ex:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>aws ec2 describe-images --image-id ami-xxx --no-include-deprecated
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>{
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    &quot;Images&quot;: [
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>        {
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>            &quot;Architecture&quot;: &quot;x86_64&quot;,
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>            &quot;CreationDate&quot;: &quot;2022-07-13T15:54:06.000Z&quot;,
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>            &quot;ImageId&quot;: &quot;ami-xxx&quot;,
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>            &quot;ImageLocation&quot;: &quot;123456789012/eks_xxx&quot;,
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>            &quot;ImageType&quot;: &quot;machine&quot;,
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>            &quot;Public&quot;: false,
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>            &quot;OwnerId&quot;: &quot;123456789012&quot;,
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>            &quot;PlatformDetails&quot;: &quot;Linux/UNIX&quot;,
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>            &quot;UsageOperation&quot;: &quot;RunInstances&quot;,
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>            &quot;State&quot;: &quot;available&quot;,
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>            &quot;BlockDeviceMappings&quot;: [
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>                {
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>                    &quot;DeviceName&quot;: &quot;/dev/xvda&quot;,
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>                    &quot;Ebs&quot;: {
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>                        &quot;DeleteOnTermination&quot;: true,
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>                        &quot;SnapshotId&quot;: &quot;snap-0993a2fc4bbf4f7f4&quot;,
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>                        &quot;VolumeSize&quot;: 20,
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>                        &quot;VolumeType&quot;: &quot;gp2&quot;,
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>                        &quot;Encrypted&quot;: false
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>                    }
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>                }
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>            ],
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>            &quot;Description&quot;: &quot;EKS Kubernetes Worker AMI with AmazonLinux2 image, (k8s: 1.19.15, docker: 20.10.13-2.amzn2, containerd: 1.4.13-3.amzn2)&quot;,
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>            &quot;EnaSupport&quot;: true,
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>            &quot;Hypervisor&quot;: &quot;xen&quot;,
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>            &quot;Name&quot;: &quot;aws_eks_optimized_xxx&quot;,
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>            &quot;RootDeviceName&quot;: &quot;/dev/xvda&quot;,
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>            &quot;RootDeviceType&quot;: &quot;ebs&quot;,
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>            &quot;SriovNetSupport&quot;: &quot;simple&quot;,
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>            &quot;VirtualizationType&quot;: &quot;hvm&quot;,
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>            &quot;DeprecationTime&quot;: &quot;2023-02-09T19:41:00.000Z&quot;
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>        }
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>    ]
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>}
</code></pre></div>







  
  



  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["tabs", "content.code.copy", "header.autohide"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>